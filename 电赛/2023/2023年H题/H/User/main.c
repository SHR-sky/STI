#include "sys.h"

uint8_t flag = 0;

double pos_angle_0; // 转换为延迟0-2pi，全部为整数的角度，重建信号延迟的相位
double pos_angle_1; // 转换为延迟0-2pi，全部为整数的角度，重建信号延迟的相位
double temp_double;
short temp_short;
double angle;
int delayTime0;
int delayTime1;

unsigned char fre[2];
unsigned char wave_type[2];

short ADCConvertedValue[1000];

double modulus(double I, double Q);
double corr1000_200(short *data, short *mask);
void get_pos_angle(void);
void cal_2frqs(unsigned char *frq);
void fft_cal_2types(unsigned char *frq, unsigned char *wave_type);

// 标准频率sin与cos表

// 修改输出波形
extern uint16_t meDA1_Value[DA1_Value_Length];
extern uint16_t meDA2_Value[DA1_Value_Length];

// 采样
extern u16 ADC1_ConvertedValue[ ADC1_DMA_Size ];

short DAC_SIN[200 * 19] =
	// 第一行是20K -> 1s 10K
    { // DAC正弦缓冲区,每行 200点。第一行有2个正弦波，第三行有4个……第19行有20个
        2142, 2236, 2329, 2421, 2512, 2600, 2687, 2771, 2852, 2930, 3004, 3075, 3141, 3204, 3262, 3314, 3362, 3405, 3443, 3475, 3501, 3521, 3536, 3545, 3548, 3545, 3536, 3521, 3501, 3475, 3443, 3405, 3362, 3314, 3262, 3204, 3141, 3075, 3004, 2930, 2852, 2771, 2687, 2600, 2512, 2421, 2329, 2236, 2142, 2048, 1954, 1860, 1767, 1675, 1584, 1496, 1409, 1325, 1244, 1166, 1092, 1021, 955, 892, 834, 782, 734, 691, 653, 621, 595, 575, 560, 551, 548, 551, 560, 575, 595, 621, 653, 691, 734, 782, 834, 892, 955, 1021, 1092, 1166, 1244, 1325, 1409, 1496, 1584, 1675, 1767, 1860, 1954, 2048, 2142, 2236, 2329, 2421, 2512, 2600, 2687, 2771, 2852, 2930, 3004, 3075, 3141, 3204, 3262, 3314, 3362, 3405, 3443, 3475, 3501, 3521, 3536, 3545, 3548, 3545, 3536, 3521, 3501, 3475, 3443, 3405, 3362, 3314, 3262, 3204, 3141, 3075, 3004, 2930, 2852, 2771, 2687, 2600, 2512, 2421, 2329, 2236, 2142, 2048, 1954, 1860, 1767, 1675, 1584, 1496, 1409, 1325, 1244, 1166, 1092, 1021, 955, 892, 834, 782, 734, 691, 653, 621, 595, 575, 560, 551, 548, 551, 560, 575, 595, 621, 653, 691, 734, 782, 834, 892, 955, 1021, 1092, 1166, 1244, 1325, 1409, 1496, 1584, 1675, 1767, 1860, 1954, 2048,
        2189, 2329, 2466, 2600, 2729, 2852, 2967, 3075, 3173, 3262, 3339, 3405, 3459, 3501, 3530, 3545, 3547, 3536, 3512, 3475, 3425, 3362, 3289, 3204, 3109, 3004, 2891, 2771, 2644, 2512, 2375, 2236, 2095, 1954, 1813, 1675, 1540, 1409, 1284, 1166, 1056, 955, 863, 782, 711, 653, 608, 575, 555, 548, 555, 575, 608, 653, 711, 782, 863, 955, 1056, 1166, 1284, 1409, 1540, 1675, 1813, 1954, 2095, 2236, 2375, 2512, 2644, 2771, 2891, 3004, 3109, 3204, 3289, 3362, 3425, 3475, 3512, 3536, 3547, 3545, 3530, 3501, 3459, 3405, 3339, 3262, 3173, 3075, 2967, 2852, 2729, 2600, 2466, 2329, 2189, 2048, 1907, 1767, 1630, 1496, 1367, 1244, 1129, 1021, 923, 834, 757, 691, 637, 595, 566, 551, 549, 560, 584, 621, 671, 734, 807, 892, 987, 1092, 1205, 1325, 1452, 1584, 1721, 1860, 2001, 2142, 2283, 2421, 2556, 2687, 2812, 2930, 3040, 3141, 3233, 3314, 3385, 3443, 3488, 3521, 3541, 3548, 3541, 3521, 3488, 3443, 3385, 3314, 3233, 3141, 3040, 2930, 2812, 2687, 2556, 2421, 2283, 2142, 2001, 1860, 1721, 1584, 1452, 1325, 1205, 1092, 987, 892, 807, 734, 671, 621, 584, 560, 549, 551, 566, 595, 637, 691, 757, 834, 923, 1021, 1129, 1244, 1367, 1496, 1630, 1767, 1907, 2048,
        2236, 2421, 2600, 2771, 2930, 3075, 3204, 3314, 3405, 3475, 3521, 3545, 3545, 3521, 3475, 3405, 3314, 3204, 3075, 2930, 2771, 2600, 2421, 2236, 2048, 1860, 1675, 1496, 1325, 1166, 1021, 892, 782, 691, 621, 575, 551, 551, 575, 621, 691, 782, 892, 1021, 1166, 1325, 1496, 1675, 1860, 2048, 2236, 2421, 2600, 2771, 2930, 3075, 3204, 3314, 3405, 3475, 3521, 3545, 3545, 3521, 3475, 3405, 3314, 3204, 3075, 2930, 2771, 2600, 2421, 2236, 2048, 1860, 1675, 1496, 1325, 1166, 1021, 892, 782, 691, 621, 575, 551, 551, 575, 621, 691, 782, 892, 1021, 1166, 1325, 1496, 1675, 1860, 2048, 2236, 2421, 2600, 2771, 2930, 3075, 3204, 3314, 3405, 3475, 3521, 3545, 3545, 3521, 3475, 3405, 3314, 3204, 3075, 2930, 2771, 2600, 2421, 2236, 2048, 1860, 1675, 1496, 1325, 1166, 1021, 892, 782, 691, 621, 575, 551, 551, 575, 621, 691, 782, 892, 1021, 1166, 1325, 1496, 1675, 1860, 2048, 2236, 2421, 2600, 2771, 2930, 3075, 3204, 3314, 3405, 3475, 3521, 3545, 3545, 3521, 3475, 3405, 3314, 3204, 3075, 2930, 2771, 2600, 2421, 2236, 2048, 1860, 1675, 1496, 1325, 1166, 1021, 892, 782, 691, 621, 575, 551, 551, 575, 621, 691, 782, 892, 1021, 1166, 1325, 1496, 1675, 1860, 2048,
        2283, 2512, 2729, 2930, 3109, 3262, 3385, 3475, 3530, 3548, 3530, 3475, 3385, 3262, 3109, 2930, 2729, 2512, 2283, 2048, 1813, 1584, 1367, 1166, 987, 834, 711, 621, 566, 548, 566, 621, 711, 834, 987, 1166, 1367, 1584, 1813, 2048, 2283, 2512, 2729, 2930, 3109, 3262, 3385, 3475, 3530, 3548, 3530, 3475, 3385, 3262, 3109, 2930, 2729, 2512, 2283, 2048, 1813, 1584, 1367, 1166, 987, 834, 711, 621, 566, 548, 566, 621, 711, 834, 987, 1166, 1367, 1584, 1813, 2048, 2283, 2512, 2729, 2930, 3109, 3262, 3385, 3475, 3530, 3548, 3530, 3475, 3385, 3262, 3109, 2930, 2729, 2512, 2283, 2048, 1813, 1584, 1367, 1166, 987, 834, 711, 621, 566, 548, 566, 621, 711, 834, 987, 1166, 1367, 1584, 1813, 2048, 2283, 2512, 2729, 2930, 3109, 3262, 3385, 3475, 3530, 3548, 3530, 3475, 3385, 3262, 3109, 2930, 2729, 2512, 2283, 2048, 1813, 1584, 1367, 1166, 987, 834, 711, 621, 566, 548, 566, 621, 711, 834, 987, 1166, 1367, 1584, 1813, 2048, 2283, 2512, 2729, 2930, 3109, 3262, 3385, 3475, 3530, 3548, 3530, 3475, 3385, 3262, 3109, 2930, 2729, 2512, 2283, 2048, 1813, 1584, 1367, 1166, 987, 834, 711, 621, 566, 548, 566, 621, 711, 834, 987, 1166, 1367, 1584, 1813, 2048,
        2329, 2600, 2852, 3075, 3262, 3405, 3501, 3545, 3536, 3475, 3362, 3204, 3004, 2771, 2512, 2236, 1954, 1675, 1409, 1166, 955, 782, 653, 575, 548, 575, 653, 782, 955, 1166, 1409, 1675, 1954, 2236, 2512, 2771, 3004, 3204, 3362, 3475, 3536, 3545, 3501, 3405, 3262, 3075, 2852, 2600, 2329, 2048, 1767, 1496, 1244, 1021, 834, 691, 595, 551, 560, 621, 734, 892, 1092, 1325, 1584, 1860, 2142, 2421, 2687, 2930, 3141, 3314, 3443, 3521, 3548, 3521, 3443, 3314, 3141, 2930, 2687, 2421, 2142, 1860, 1584, 1325, 1092, 892, 734, 621, 560, 551, 595, 691, 834, 1021, 1244, 1496, 1767, 2048, 2329, 2600, 2852, 3075, 3262, 3405, 3501, 3545, 3536, 3475, 3362, 3204, 3004, 2771, 2512, 2236, 1954, 1675, 1409, 1166, 955, 782, 653, 575, 548, 575, 653, 782, 955, 1166, 1409, 1675, 1954, 2236, 2512, 2771, 3004, 3204, 3362, 3475, 3536, 3545, 3501, 3405, 3262, 3075, 2852, 2600, 2329, 2048, 1767, 1496, 1244, 1021, 834, 691, 595, 551, 560, 621, 734, 892, 1092, 1325, 1584, 1860, 2142, 2421, 2687, 2930, 3141, 3314, 3443, 3521, 3548, 3521, 3443, 3314, 3141, 2930, 2687, 2421, 2142, 1860, 1584, 1325, 1092, 892, 734, 621, 560, 551, 595, 691, 834, 1021, 1244, 1496, 1767, 2048,
        2375, 2687, 2967, 3204, 3385, 3501, 3547, 3521, 3425, 3262, 3040, 2771, 2466, 2142, 1813, 1496, 1205, 955, 757, 621, 555, 560, 637, 782, 987, 1244, 1540, 1860, 2189, 2512, 2812, 3075, 3289, 3443, 3530, 3545, 3488, 3362, 3173, 2930, 2644, 2329, 2001, 1675, 1367, 1092, 863, 691, 584, 548, 584, 691, 863, 1092, 1367, 1675, 2001, 2329, 2644, 2930, 3173, 3362, 3488, 3545, 3530, 3443, 3289, 3075, 2812, 2512, 2189, 1860, 1540, 1244, 987, 782, 637, 560, 555, 621, 757, 955, 1205, 1496, 1813, 2142, 2466, 2771, 3040, 3262, 3425, 3521, 3547, 3501, 3385, 3204, 2967, 2687, 2375, 2048, 1721, 1409, 1129, 892, 711, 595, 549, 575, 671, 834, 1056, 1325, 1630, 1954, 2283, 2600, 2891, 3141, 3339, 3475, 3541, 3536, 3459, 3314, 3109, 2852, 2556, 2236, 1907, 1584, 1284, 1021, 807, 653, 566, 551, 608, 734, 923, 1166, 1452, 1767, 2095, 2421, 2729, 3004, 3233, 3405, 3512, 3548, 3512, 3405, 3233, 3004, 2729, 2421, 2095, 1767, 1452, 1166, 923, 734, 608, 551, 566, 653, 807, 1021, 1284, 1584, 1907, 2236, 2556, 2852, 3109, 3314, 3459, 3536, 3541, 3475, 3339, 3141, 2891, 2600, 2283, 1954, 1630, 1325, 1056, 834, 671, 575, 549, 595, 711, 892, 1129, 1409, 1721, 2048,
        2421, 2771, 3075, 3314, 3475, 3545, 3521, 3405, 3204, 2930, 2600, 2236, 1860, 1496, 1166, 892, 691, 575, 551, 621, 782, 1021, 1325, 1675, 2048, 2421, 2771, 3075, 3314, 3475, 3545, 3521, 3405, 3204, 2930, 2600, 2236, 1860, 1496, 1166, 892, 691, 575, 551, 621, 782, 1021, 1325, 1675, 2048, 2421, 2771, 3075, 3314, 3475, 3545, 3521, 3405, 3204, 2930, 2600, 2236, 1860, 1496, 1166, 892, 691, 575, 551, 621, 782, 1021, 1325, 1675, 2048, 2421, 2771, 3075, 3314, 3475, 3545, 3521, 3405, 3204, 2930, 2600, 2236, 1860, 1496, 1166, 892, 691, 575, 551, 621, 782, 1021, 1325, 1675, 2048, 2421, 2771, 3075, 3314, 3475, 3545, 3521, 3405, 3204, 2930, 2600, 2236, 1860, 1496, 1166, 892, 691, 575, 551, 621, 782, 1021, 1325, 1675, 2048, 2421, 2771, 3075, 3314, 3475, 3545, 3521, 3405, 3204, 2930, 2600, 2236, 1860, 1496, 1166, 892, 691, 575, 551, 621, 782, 1021, 1325, 1675, 2048, 2421, 2771, 3075, 3314, 3475, 3545, 3521, 3405, 3204, 2930, 2600, 2236, 1860, 1496, 1166, 892, 691, 575, 551, 621, 782, 1021, 1325, 1675, 2048, 2421, 2771, 3075, 3314, 3475, 3545, 3521, 3405, 3204, 2930, 2600, 2236, 1860, 1496, 1166, 892, 691, 575, 551, 621, 782, 1021, 1325, 1675, 2048,
        2466, 2852, 3173, 3405, 3530, 3536, 3425, 3204, 2891, 2512, 2095, 1675, 1284, 955, 711, 575, 555, 653, 863, 1166, 1540, 1954, 2375, 2771, 3109, 3362, 3512, 3545, 3459, 3262, 2967, 2600, 2189, 1767, 1367, 1021, 757, 595, 549, 621, 807, 1092, 1452, 1860, 2283, 2687, 3040, 3314, 3488, 3548, 3488, 3314, 3040, 2687, 2283, 1860, 1452, 1092, 807, 621, 549, 595, 757, 1021, 1367, 1767, 2189, 2600, 2967, 3262, 3459, 3545, 3512, 3362, 3109, 2771, 2375, 1954, 1540, 1166, 863, 653, 555, 575, 711, 955, 1284, 1675, 2095, 2512, 2891, 3204, 3425, 3536, 3530, 3405, 3173, 2852, 2466, 2048, 1630, 1244, 923, 691, 566, 560, 671, 892, 1205, 1584, 2001, 2421, 2812, 3141, 3385, 3521, 3541, 3443, 3233, 2930, 2556, 2142, 1721, 1325, 987, 734, 584, 551, 637, 834, 1129, 1496, 1907, 2329, 2729, 3075, 3339, 3501, 3547, 3475, 3289, 3004, 2644, 2236, 1813, 1409, 1056, 782, 608, 548, 608, 782, 1056, 1409, 1813, 2236, 2644, 3004, 3289, 3475, 3547, 3501, 3339, 3075, 2729, 2329, 1907, 1496, 1129, 834, 637, 551, 584, 734, 987, 1325, 1721, 2142, 2556, 2930, 3233, 3443, 3541, 3521, 3385, 3141, 2812, 2421, 2001, 1584, 1205, 892, 671, 560, 566, 691, 923, 1244, 1630, 2048,
        2512, 2930, 3262, 3475, 3548, 3475, 3262, 2930, 2512, 2048, 1584, 1166, 834, 621, 548, 621, 834, 1166, 1584, 2048, 2512, 2930, 3262, 3475, 3548, 3475, 3262, 2930, 2512, 2048, 1584, 1166, 834, 621, 548, 621, 834, 1166, 1584, 2048, 2512, 2930, 3262, 3475, 3548, 3475, 3262, 2930, 2512, 2048, 1584, 1166, 834, 621, 548, 621, 834, 1166, 1584, 2048, 2512, 2930, 3262, 3475, 3548, 3475, 3262, 2930, 2512, 2048, 1584, 1166, 834, 621, 548, 621, 834, 1166, 1584, 2048, 2512, 2930, 3262, 3475, 3548, 3475, 3262, 2930, 2512, 2048, 1584, 1166, 834, 621, 548, 621, 834, 1166, 1584, 2048, 2512, 2930, 3262, 3475, 3548, 3475, 3262, 2930, 2512, 2048, 1584, 1166, 834, 621, 548, 621, 834, 1166, 1584, 2048, 2512, 2930, 3262, 3475, 3548, 3475, 3262, 2930, 2512, 2048, 1584, 1166, 834, 621, 548, 621, 834, 1166, 1584, 2048, 2512, 2930, 3262, 3475, 3548, 3475, 3262, 2930, 2512, 2048, 1584, 1166, 834, 621, 548, 621, 834, 1166, 1584, 2048, 2512, 2930, 3262, 3475, 3548, 3475, 3262, 2930, 2512, 2048, 1584, 1166, 834, 621, 548, 621, 834, 1166, 1584, 2048, 2512, 2930, 3262, 3475, 3548, 3475, 3262, 2930, 2512, 2048, 1584, 1166, 834, 621, 548, 621, 834, 1166, 1584, 2048,
        2556, 3004, 3339, 3521, 3530, 3362, 3040, 2600, 2095, 1584, 1129, 782, 584, 560, 711, 1021, 1452, 1954, 2466, 2930, 3289, 3501, 3541, 3405, 3109, 2687, 2189, 1675, 1205, 834, 608, 551, 671, 955, 1367, 1860, 2375, 2852, 3233, 3475, 3547, 3443, 3173, 2771, 2283, 1767, 1284, 892, 637, 548, 637, 892, 1284, 1767, 2283, 2771, 3173, 3443, 3547, 3475, 3233, 2852, 2375, 1860, 1367, 955, 671, 551, 608, 834, 1205, 1675, 2189, 2687, 3109, 3405, 3541, 3501, 3289, 2930, 2466, 1954, 1452, 1021, 711, 560, 584, 782, 1129, 1584, 2095, 2600, 3040, 3362, 3530, 3521, 3339, 3004, 2556, 2048, 1540, 1092, 757, 575, 566, 734, 1056, 1496, 2001, 2512, 2967, 3314, 3512, 3536, 3385, 3075, 2644, 2142, 1630, 1166, 807, 595, 555, 691, 987, 1409, 1907, 2421, 2891, 3262, 3488, 3545, 3425, 3141, 2729, 2236, 1721, 1244, 863, 621, 549, 653, 923, 1325, 1813, 2329, 2812, 3204, 3459, 3548, 3459, 3204, 2812, 2329, 1813, 1325, 923, 653, 549, 621, 863, 1244, 1721, 2236, 2729, 3141, 3425, 3545, 3488, 3262, 2891, 2421, 1907, 1409, 987, 691, 555, 595, 807, 1166, 1630, 2142, 2644, 3075, 3385, 3536, 3512, 3314, 2967, 2512, 2001, 1496, 1056, 734, 566, 575, 757, 1092, 1540, 2048,
        2600, 3075, 3405, 3545, 3475, 3204, 2771, 2236, 1675, 1166, 782, 575, 575, 782, 1166, 1675, 2236, 2771, 3204, 3475, 3545, 3405, 3075, 2600, 2048, 1496, 1021, 691, 551, 621, 892, 1325, 1860, 2421, 2930, 3314, 3521, 3521, 3314, 2930, 2421, 1860, 1325, 892, 621, 551, 691, 1021, 1496, 2048, 2600, 3075, 3405, 3545, 3475, 3204, 2771, 2236, 1675, 1166, 782, 575, 575, 782, 1166, 1675, 2236, 2771, 3204, 3475, 3545, 3405, 3075, 2600, 2048, 1496, 1021, 691, 551, 621, 892, 1325, 1860, 2421, 2930, 3314, 3521, 3521, 3314, 2930, 2421, 1860, 1325, 892, 621, 551, 691, 1021, 1496, 2048, 2600, 3075, 3405, 3545, 3475, 3204, 2771, 2236, 1675, 1166, 782, 575, 575, 782, 1166, 1675, 2236, 2771, 3204, 3475, 3545, 3405, 3075, 2600, 2048, 1496, 1021, 691, 551, 621, 892, 1325, 1860, 2421, 2930, 3314, 3521, 3521, 3314, 2930, 2421, 1860, 1325, 892, 621, 551, 691, 1021, 1496, 2048, 2600, 3075, 3405, 3545, 3475, 3204, 2771, 2236, 1675, 1166, 782, 575, 575, 782, 1166, 1675, 2236, 2771, 3204, 3475, 3545, 3405, 3075, 2600, 2048, 1496, 1021, 691, 551, 621, 892, 1325, 1860, 2421, 2930, 3314, 3521, 3521, 3314, 2930, 2421, 1860, 1325, 892, 621, 551, 691, 1021, 1496, 2048,
        2644, 3141, 3459, 3545, 3385, 3004, 2466, 1860, 1284, 834, 584, 575, 807, 1244, 1813, 2421, 2967, 3362, 3541, 3475, 3173, 2687, 2095, 1496, 987, 653, 549, 691, 1056, 1584, 2189, 2771, 3233, 3501, 3530, 3314, 2891, 2329, 1721, 1166, 757, 560, 608, 892, 1367, 1954, 2556, 3075, 3425, 3548, 3425, 3075, 2556, 1954, 1367, 892, 608, 560, 757, 1166, 1721, 2329, 2891, 3314, 3530, 3501, 3233, 2771, 2189, 1584, 1056, 691, 549, 653, 987, 1496, 2095, 2687, 3173, 3475, 3541, 3362, 2967, 2421, 1813, 1244, 807, 575, 584, 834, 1284, 1860, 2466, 3004, 3385, 3545, 3459, 3141, 2644, 2048, 1452, 955, 637, 551, 711, 1092, 1630, 2236, 2812, 3262, 3512, 3521, 3289, 2852, 2283, 1675, 1129, 734, 555, 621, 923, 1409, 2001, 2600, 3109, 3443, 3547, 3405, 3040, 2512, 1907, 1325, 863, 595, 566, 782, 1205, 1767, 2375, 2930, 3339, 3536, 3488, 3204, 2729, 2142, 1540, 1021, 671, 548, 671, 1021, 1540, 2142, 2729, 3204, 3488, 3536, 3339, 2930, 2375, 1767, 1205, 782, 566, 595, 863, 1325, 1907, 2512, 3040, 3405, 3547, 3443, 3109, 2600, 2001, 1409, 923, 621, 555, 734, 1129, 1675, 2283, 2852, 3289, 3521, 3512, 3262, 2812, 2236, 1630, 1092, 711, 551, 637, 955, 1452, 2048,
        2687, 3204, 3501, 3521, 3262, 2771, 2142, 1496, 955, 621, 560, 782, 1244, 1860, 2512, 3075, 3443, 3545, 3362, 2930, 2329, 1675, 1092, 691, 548, 691, 1092, 1675, 2329, 2930, 3362, 3545, 3443, 3075, 2512, 1860, 1244, 782, 560, 621, 955, 1496, 2142, 2771, 3262, 3521, 3501, 3204, 2687, 2048, 1409, 892, 595, 575, 834, 1325, 1954, 2600, 3141, 3475, 3536, 3314, 2852, 2236, 1584, 1021, 653, 551, 734, 1166, 1767, 2421, 3004, 3405, 3548, 3405, 3004, 2421, 1767, 1166, 734, 551, 653, 1021, 1584, 2236, 2852, 3314, 3536, 3475, 3141, 2600, 1954, 1325, 834, 575, 595, 892, 1409, 2048, 2687, 3204, 3501, 3521, 3262, 2771, 2142, 1496, 955, 621, 560, 782, 1244, 1860, 2512, 3075, 3443, 3545, 3362, 2930, 2329, 1675, 1092, 691, 548, 691, 1092, 1675, 2329, 2930, 3362, 3545, 3443, 3075, 2512, 1860, 1244, 782, 560, 621, 955, 1496, 2142, 2771, 3262, 3521, 3501, 3204, 2687, 2048, 1409, 892, 595, 575, 834, 1325, 1954, 2600, 3141, 3475, 3536, 3314, 2852, 2236, 1584, 1021, 653, 551, 734, 1166, 1767, 2421, 3004, 3405, 3548, 3405, 3004, 2421, 1767, 1166, 734, 551, 653, 1021, 1584, 2236, 2852, 3314, 3536, 3475, 3141, 2600, 1954, 1325, 834, 575, 595, 892, 1409, 2048,
        2729, 3262, 3530, 3475, 3109, 2512, 1813, 1166, 711, 548, 711, 1166, 1813, 2512, 3109, 3475, 3530, 3262, 2729, 2048, 1367, 834, 566, 621, 987, 1584, 2283, 2930, 3385, 3548, 3385, 2930, 2283, 1584, 987, 621, 566, 834, 1367, 2048, 2729, 3262, 3530, 3475, 3109, 2512, 1813, 1166, 711, 548, 711, 1166, 1813, 2512, 3109, 3475, 3530, 3262, 2729, 2048, 1367, 834, 566, 621, 987, 1584, 2283, 2930, 3385, 3548, 3385, 2930, 2283, 1584, 987, 621, 566, 834, 1367, 2048, 2729, 3262, 3530, 3475, 3109, 2512, 1813, 1166, 711, 548, 711, 1166, 1813, 2512, 3109, 3475, 3530, 3262, 2729, 2048, 1367, 834, 566, 621, 987, 1584, 2283, 2930, 3385, 3548, 3385, 2930, 2283, 1584, 987, 621, 566, 834, 1367, 2048, 2729, 3262, 3530, 3475, 3109, 2512, 1813, 1166, 711, 548, 711, 1166, 1813, 2512, 3109, 3475, 3530, 3262, 2729, 2048, 1367, 834, 566, 621, 987, 1584, 2283, 2930, 3385, 3548, 3385, 2930, 2283, 1584, 987, 621, 566, 834, 1367, 2048, 2729, 3262, 3530, 3475, 3109, 2512, 1813, 1166, 711, 548, 711, 1166, 1813, 2512, 3109, 3475, 3530, 3262, 2729, 2048, 1367, 834, 566, 621, 987, 1584, 2283, 2930, 3385, 3548, 3385, 2930, 2283, 1584, 987, 621, 566, 834, 1367, 2048,
        2771, 3314, 3545, 3405, 2930, 2236, 1496, 892, 575, 621, 1021, 1675, 2421, 3075, 3475, 3521, 3204, 2600, 1860, 1166, 691, 551, 782, 1325, 2048, 2771, 3314, 3545, 3405, 2930, 2236, 1496, 892, 575, 621, 1021, 1675, 2421, 3075, 3475, 3521, 3204, 2600, 1860, 1166, 691, 551, 782, 1325, 2048, 2771, 3314, 3545, 3405, 2930, 2236, 1496, 892, 575, 621, 1021, 1675, 2421, 3075, 3475, 3521, 3204, 2600, 1860, 1166, 691, 551, 782, 1325, 2048, 2771, 3314, 3545, 3405, 2930, 2236, 1496, 892, 575, 621, 1021, 1675, 2421, 3075, 3475, 3521, 3204, 2600, 1860, 1166, 691, 551, 782, 1325, 2048, 2771, 3314, 3545, 3405, 2930, 2236, 1496, 892, 575, 621, 1021, 1675, 2421, 3075, 3475, 3521, 3204, 2600, 1860, 1166, 691, 551, 782, 1325, 2048, 2771, 3314, 3545, 3405, 2930, 2236, 1496, 892, 575, 621, 1021, 1675, 2421, 3075, 3475, 3521, 3204, 2600, 1860, 1166, 691, 551, 782, 1325, 2048, 2771, 3314, 3545, 3405, 2930, 2236, 1496, 892, 575, 621, 1021, 1675, 2421, 3075, 3475, 3521, 3204, 2600, 1860, 1166, 691, 551, 782, 1325, 2048, 2771, 3314, 3545, 3405, 2930, 2236, 1496, 892, 575, 621, 1021, 1675, 2421, 3075, 3475, 3521, 3204, 2600, 1860, 1166, 691, 551, 782, 1325, 2048,
        2812, 3362, 3547, 3314, 2729, 1954, 1205, 691, 555, 834, 1452, 2236, 2967, 3443, 3530, 3204, 2556, 1767, 1056, 621, 584, 955, 1630, 2421, 3109, 3501, 3488, 3075, 2375, 1584, 923, 575, 637, 1092, 1813, 2600, 3233, 3536, 3425, 2930, 2189, 1409, 807, 551, 711, 1244, 2001, 2771, 3339, 3548, 3339, 2771, 2001, 1244, 711, 551, 807, 1409, 2189, 2930, 3425, 3536, 3233, 2600, 1813, 1092, 637, 575, 923, 1584, 2375, 3075, 3488, 3501, 3109, 2421, 1630, 955, 584, 621, 1056, 1767, 2556, 3204, 3530, 3443, 2967, 2236, 1452, 834, 555, 691, 1205, 1954, 2729, 3314, 3547, 3362, 2812, 2048, 1284, 734, 549, 782, 1367, 2142, 2891, 3405, 3541, 3262, 2644, 1860, 1129, 653, 566, 892, 1540, 2329, 3040, 3475, 3512, 3141, 2466, 1675, 987, 595, 608, 1021, 1721, 2512, 3173, 3521, 3459, 3004, 2283, 1496, 863, 560, 671, 1166, 1907, 2687, 3289, 3545, 3385, 2852, 2095, 1325, 757, 548, 757, 1325, 2095, 2852, 3385, 3545, 3289, 2687, 1907, 1166, 671, 560, 863, 1496, 2283, 3004, 3459, 3521, 3173, 2512, 1721, 1021, 608, 595, 987, 1675, 2466, 3141, 3512, 3475, 3040, 2329, 1540, 892, 566, 653, 1129, 1860, 2644, 3262, 3541, 3405, 2891, 2142, 1367, 782, 549, 734, 1284, 2048,
        2852, 3405, 3536, 3204, 2512, 1675, 955, 575, 653, 1166, 1954, 2771, 3362, 3545, 3262, 2600, 1767, 1021, 595, 621, 1092, 1860, 2687, 3314, 3548, 3314, 2687, 1860, 1092, 621, 595, 1021, 1767, 2600, 3262, 3545, 3362, 2771, 1954, 1166, 653, 575, 955, 1675, 2512, 3204, 3536, 3405, 2852, 2048, 1244, 691, 560, 892, 1584, 2421, 3141, 3521, 3443, 2930, 2142, 1325, 734, 551, 834, 1496, 2329, 3075, 3501, 3475, 3004, 2236, 1409, 782, 548, 782, 1409, 2236, 3004, 3475, 3501, 3075, 2329, 1496, 834, 551, 734, 1325, 2142, 2930, 3443, 3521, 3141, 2421, 1584, 892, 560, 691, 1244, 2048, 2852, 3405, 3536, 3204, 2512, 1675, 955, 575, 653, 1166, 1954, 2771, 3362, 3545, 3262, 2600, 1767, 1021, 595, 621, 1092, 1860, 2687, 3314, 3548, 3314, 2687, 1860, 1092, 621, 595, 1021, 1767, 2600, 3262, 3545, 3362, 2771, 1954, 1166, 653, 575, 955, 1675, 2512, 3204, 3536, 3405, 2852, 2048, 1244, 691, 560, 892, 1584, 2421, 3141, 3521, 3443, 2930, 2142, 1325, 734, 551, 834, 1496, 2329, 3075, 3501, 3475, 3004, 2236, 1409, 782, 548, 782, 1409, 2236, 3004, 3475, 3501, 3075, 2329, 1496, 834, 551, 734, 1325, 2142, 2930, 3443, 3521, 3141, 2421, 1584, 892, 560, 691, 1244, 2048,
        2891, 3443, 3512, 3075, 2283, 1409, 757, 551, 863, 1584, 2466, 3204, 3541, 3362, 2729, 1860, 1056, 595, 637, 1166, 2001, 2852, 3425, 3521, 3109, 2329, 1452, 782, 549, 834, 1540, 2421, 3173, 3536, 3385, 2771, 1907, 1092, 608, 621, 1129, 1954, 2812, 3405, 3530, 3141, 2375, 1496, 807, 548, 807, 1496, 2375, 3141, 3530, 3405, 2812, 1954, 1129, 621, 608, 1092, 1907, 2771, 3385, 3536, 3173, 2421, 1540, 834, 549, 782, 1452, 2329, 3109, 3521, 3425, 2852, 2001, 1166, 637, 595, 1056, 1860, 2729, 3362, 3541, 3204, 2466, 1584, 863, 551, 757, 1409, 2283, 3075, 3512, 3443, 2891, 2048, 1205, 653, 584, 1021, 1813, 2687, 3339, 3545, 3233, 2512, 1630, 892, 555, 734, 1367, 2236, 3040, 3501, 3459, 2930, 2095, 1244, 671, 575, 987, 1767, 2644, 3314, 3547, 3262, 2556, 1675, 923, 560, 711, 1325, 2189, 3004, 3488, 3475, 2967, 2142, 1284, 691, 566, 955, 1721, 2600, 3289, 3548, 3289, 2600, 1721, 955, 566, 691, 1284, 2142, 2967, 3475, 3488, 3004, 2189, 1325, 711, 560, 923, 1675, 2556, 3262, 3547, 3314, 2644, 1767, 987, 575, 671, 1244, 2095, 2930, 3459, 3501, 3040, 2236, 1367, 734, 555, 892, 1630, 2512, 3233, 3545, 3339, 2687, 1813, 1021, 584, 653, 1205, 2048,
        2930, 3475, 3475, 2930, 2048, 1166, 621, 621, 1166, 2048, 2930, 3475, 3475, 2930, 2048, 1166, 621, 621, 1166, 2048, 2930, 3475, 3475, 2930, 2048, 1166, 621, 621, 1166, 2048, 2930, 3475, 3475, 2930, 2048, 1166, 621, 621, 1166, 2048, 2930, 3475, 3475, 2930, 2048, 1166, 621, 621, 1166, 2048, 2930, 3475, 3475, 2930, 2048, 1166, 621, 621, 1166, 2048, 2930, 3475, 3475, 2930, 2048, 1166, 621, 621, 1166, 2048, 2930, 3475, 3475, 2930, 2048, 1166, 621, 621, 1166, 2048, 2930, 3475, 3475, 2930, 2048, 1166, 621, 621, 1166, 2048, 2930, 3475, 3475, 2930, 2048, 1166, 621, 621, 1166, 2048, 2930, 3475, 3475, 2930, 2048, 1166, 621, 621, 1166, 2048, 2930, 3475, 3475, 2930, 2048, 1166, 621, 621, 1166, 2048, 2930, 3475, 3475, 2930, 2048, 1166, 621, 621, 1166, 2048, 2930, 3475, 3475, 2930, 2048, 1166, 621, 621, 1166, 2048, 2930, 3475, 3475, 2930, 2048, 1166, 621, 621, 1166, 2048, 2930, 3475, 3475, 2930, 2048, 1166, 621, 621, 1166, 2048, 2930, 3475, 3475, 2930, 2048, 1166, 621, 621, 1166, 2048, 2930, 3475, 3475, 2930, 2048, 1166, 621, 621, 1166, 2048, 2930, 3475, 3475, 2930, 2048, 1166, 621, 621, 1166, 2048, 2930, 3475, 3475, 2930, 2048, 1166, 621, 621, 1166, 2048};
short DAC_COS[200 * 19] =
    { // DAC余弦缓冲区,每行 200点。第一行有2个正弦波，第三行有4个……第19行有20个
        3545, 3536, 3521, 3501, 3475, 3443, 3405, 3362, 3314, 3262, 3204, 3141, 3075, 3004, 2930, 2852, 2771, 2687, 2600, 2512, 2421, 2329, 2236, 2142, 2048, 1954, 1860, 1767, 1675, 1584, 1496, 1409, 1325, 1244, 1166, 1092, 1021, 955, 892, 834, 782, 734, 691, 653, 621, 595, 575, 560, 551, 548, 551, 560, 575, 595, 621, 653, 691, 734, 782, 834, 892, 955, 1021, 1092, 1166, 1244, 1325, 1409, 1496, 1584, 1675, 1767, 1860, 1954, 2048, 2142, 2236, 2329, 2421, 2512, 2600, 2687, 2771, 2852, 2930, 3004, 3075, 3141, 3204, 3262, 3314, 3362, 3405, 3443, 3475, 3501, 3521, 3536, 3545, 3548, 3545, 3536, 3521, 3501, 3475, 3443, 3405, 3362, 3314, 3262, 3204, 3141, 3075, 3004, 2930, 2852, 2771, 2687, 2600, 2512, 2421, 2329, 2236, 2142, 2048, 1954, 1860, 1767, 1675, 1584, 1496, 1409, 1325, 1244, 1166, 1092, 1021, 955, 892, 834, 782, 734, 691, 653, 621, 595, 575, 560, 551, 548, 551, 560, 575, 595, 621, 653, 691, 734, 782, 834, 892, 955, 1021, 1092, 1166, 1244, 1325, 1409, 1496, 1584, 1675, 1767, 1860, 1954, 2048, 2142, 2236, 2329, 2421, 2512, 2600, 2687, 2771, 2852, 2930, 3004, 3075, 3141, 3204, 3262, 3314, 3362, 3405, 3443, 3475, 3501, 3521, 3536, 3545, 3548,
        3541, 3521, 3488, 3443, 3385, 3314, 3233, 3141, 3040, 2930, 2812, 2687, 2556, 2421, 2283, 2142, 2001, 1860, 1721, 1584, 1452, 1325, 1205, 1092, 987, 892, 807, 734, 671, 621, 584, 560, 549, 551, 566, 595, 637, 691, 757, 834, 923, 1021, 1129, 1244, 1367, 1496, 1630, 1767, 1907, 2048, 2189, 2329, 2466, 2600, 2729, 2852, 2967, 3075, 3173, 3262, 3339, 3405, 3459, 3501, 3530, 3545, 3547, 3536, 3512, 3475, 3425, 3362, 3289, 3204, 3109, 3004, 2891, 2771, 2644, 2512, 2375, 2236, 2095, 1954, 1813, 1675, 1540, 1409, 1284, 1166, 1056, 955, 863, 782, 711, 653, 608, 575, 555, 548, 555, 575, 608, 653, 711, 782, 863, 955, 1056, 1166, 1284, 1409, 1540, 1675, 1813, 1954, 2095, 2236, 2375, 2512, 2644, 2771, 2891, 3004, 3109, 3204, 3289, 3362, 3425, 3475, 3512, 3536, 3547, 3545, 3530, 3501, 3459, 3405, 3339, 3262, 3173, 3075, 2967, 2852, 2729, 2600, 2466, 2329, 2189, 2048, 1907, 1767, 1630, 1496, 1367, 1244, 1129, 1021, 923, 834, 757, 691, 637, 595, 566, 551, 549, 560, 584, 621, 671, 734, 807, 892, 987, 1092, 1205, 1325, 1452, 1584, 1721, 1860, 2001, 2142, 2283, 2421, 2556, 2687, 2812, 2930, 3040, 3141, 3233, 3314, 3385, 3443, 3488, 3521, 3541, 3548,
        3536, 3501, 3443, 3362, 3262, 3141, 3004, 2852, 2687, 2512, 2329, 2142, 1954, 1767, 1584, 1409, 1244, 1092, 955, 834, 734, 653, 595, 560, 548, 560, 595, 653, 734, 834, 955, 1092, 1244, 1409, 1584, 1767, 1954, 2142, 2329, 2512, 2687, 2852, 3004, 3141, 3262, 3362, 3443, 3501, 3536, 3548, 3536, 3501, 3443, 3362, 3262, 3141, 3004, 2852, 2687, 2512, 2329, 2142, 1954, 1767, 1584, 1409, 1244, 1092, 955, 834, 734, 653, 595, 560, 548, 560, 595, 653, 734, 834, 955, 1092, 1244, 1409, 1584, 1767, 1954, 2142, 2329, 2512, 2687, 2852, 3004, 3141, 3262, 3362, 3443, 3501, 3536, 3548, 3536, 3501, 3443, 3362, 3262, 3141, 3004, 2852, 2687, 2512, 2329, 2142, 1954, 1767, 1584, 1409, 1244, 1092, 955, 834, 734, 653, 595, 560, 548, 560, 595, 653, 734, 834, 955, 1092, 1244, 1409, 1584, 1767, 1954, 2142, 2329, 2512, 2687, 2852, 3004, 3141, 3262, 3362, 3443, 3501, 3536, 3548, 3536, 3501, 3443, 3362, 3262, 3141, 3004, 2852, 2687, 2512, 2329, 2142, 1954, 1767, 1584, 1409, 1244, 1092, 955, 834, 734, 653, 595, 560, 548, 560, 595, 653, 734, 834, 955, 1092, 1244, 1409, 1584, 1767, 1954, 2142, 2329, 2512, 2687, 2852, 3004, 3141, 3262, 3362, 3443, 3501, 3536, 3548,
        3530, 3475, 3385, 3262, 3109, 2930, 2729, 2512, 2283, 2048, 1813, 1584, 1367, 1166, 987, 834, 711, 621, 566, 548, 566, 621, 711, 834, 987, 1166, 1367, 1584, 1813, 2048, 2283, 2512, 2729, 2930, 3109, 3262, 3385, 3475, 3530, 3548, 3530, 3475, 3385, 3262, 3109, 2930, 2729, 2512, 2283, 2048, 1813, 1584, 1367, 1166, 987, 834, 711, 621, 566, 548, 566, 621, 711, 834, 987, 1166, 1367, 1584, 1813, 2048, 2283, 2512, 2729, 2930, 3109, 3262, 3385, 3475, 3530, 3548, 3530, 3475, 3385, 3262, 3109, 2930, 2729, 2512, 2283, 2048, 1813, 1584, 1367, 1166, 987, 834, 711, 621, 566, 548, 566, 621, 711, 834, 987, 1166, 1367, 1584, 1813, 2048, 2283, 2512, 2729, 2930, 3109, 3262, 3385, 3475, 3530, 3548, 3530, 3475, 3385, 3262, 3109, 2930, 2729, 2512, 2283, 2048, 1813, 1584, 1367, 1166, 987, 834, 711, 621, 566, 548, 566, 621, 711, 834, 987, 1166, 1367, 1584, 1813, 2048, 2283, 2512, 2729, 2930, 3109, 3262, 3385, 3475, 3530, 3548, 3530, 3475, 3385, 3262, 3109, 2930, 2729, 2512, 2283, 2048, 1813, 1584, 1367, 1166, 987, 834, 711, 621, 566, 548, 566, 621, 711, 834, 987, 1166, 1367, 1584, 1813, 2048, 2283, 2512, 2729, 2930, 3109, 3262, 3385, 3475, 3530, 3548,
        3521, 3443, 3314, 3141, 2930, 2687, 2421, 2142, 1860, 1584, 1325, 1092, 892, 734, 621, 560, 551, 595, 691, 834, 1021, 1244, 1496, 1767, 2048, 2329, 2600, 2852, 3075, 3262, 3405, 3501, 3545, 3536, 3475, 3362, 3204, 3004, 2771, 2512, 2236, 1954, 1675, 1409, 1166, 955, 782, 653, 575, 548, 575, 653, 782, 955, 1166, 1409, 1675, 1954, 2236, 2512, 2771, 3004, 3204, 3362, 3475, 3536, 3545, 3501, 3405, 3262, 3075, 2852, 2600, 2329, 2048, 1767, 1496, 1244, 1021, 834, 691, 595, 551, 560, 621, 734, 892, 1092, 1325, 1584, 1860, 2142, 2421, 2687, 2930, 3141, 3314, 3443, 3521, 3548, 3521, 3443, 3314, 3141, 2930, 2687, 2421, 2142, 1860, 1584, 1325, 1092, 892, 734, 621, 560, 551, 595, 691, 834, 1021, 1244, 1496, 1767, 2048, 2329, 2600, 2852, 3075, 3262, 3405, 3501, 3545, 3536, 3475, 3362, 3204, 3004, 2771, 2512, 2236, 1954, 1675, 1409, 1166, 955, 782, 653, 575, 548, 575, 653, 782, 955, 1166, 1409, 1675, 1954, 2236, 2512, 2771, 3004, 3204, 3362, 3475, 3536, 3545, 3501, 3405, 3262, 3075, 2852, 2600, 2329, 2048, 1767, 1496, 1244, 1021, 834, 691, 595, 551, 560, 621, 734, 892, 1092, 1325, 1584, 1860, 2142, 2421, 2687, 2930, 3141, 3314, 3443, 3521, 3548,
        3512, 3405, 3233, 3004, 2729, 2421, 2095, 1767, 1452, 1166, 923, 734, 608, 551, 566, 653, 807, 1021, 1284, 1584, 1907, 2236, 2556, 2852, 3109, 3314, 3459, 3536, 3541, 3475, 3339, 3141, 2891, 2600, 2283, 1954, 1630, 1325, 1056, 834, 671, 575, 549, 595, 711, 892, 1129, 1409, 1721, 2048, 2375, 2687, 2967, 3204, 3385, 3501, 3547, 3521, 3425, 3262, 3040, 2771, 2466, 2142, 1813, 1496, 1205, 955, 757, 621, 555, 560, 637, 782, 987, 1244, 1540, 1860, 2189, 2512, 2812, 3075, 3289, 3443, 3530, 3545, 3488, 3362, 3173, 2930, 2644, 2329, 2001, 1675, 1367, 1092, 863, 691, 584, 548, 584, 691, 863, 1092, 1367, 1675, 2001, 2329, 2644, 2930, 3173, 3362, 3488, 3545, 3530, 3443, 3289, 3075, 2812, 2512, 2189, 1860, 1540, 1244, 987, 782, 637, 560, 555, 621, 757, 955, 1205, 1496, 1813, 2142, 2466, 2771, 3040, 3262, 3425, 3521, 3547, 3501, 3385, 3204, 2967, 2687, 2375, 2048, 1721, 1409, 1129, 892, 711, 595, 549, 575, 671, 834, 1056, 1325, 1630, 1954, 2283, 2600, 2891, 3141, 3339, 3475, 3541, 3536, 3459, 3314, 3109, 2852, 2556, 2236, 1907, 1584, 1284, 1021, 807, 653, 566, 551, 608, 734, 923, 1166, 1452, 1767, 2095, 2421, 2729, 3004, 3233, 3405, 3512, 3548,
        3501, 3362, 3141, 2852, 2512, 2142, 1767, 1409, 1092, 834, 653, 560, 560, 653, 834, 1092, 1409, 1767, 2142, 2512, 2852, 3141, 3362, 3501, 3548, 3501, 3362, 3141, 2852, 2512, 2142, 1767, 1409, 1092, 834, 653, 560, 560, 653, 834, 1092, 1409, 1767, 2142, 2512, 2852, 3141, 3362, 3501, 3548, 3501, 3362, 3141, 2852, 2512, 2142, 1767, 1409, 1092, 834, 653, 560, 560, 653, 834, 1092, 1409, 1767, 2142, 2512, 2852, 3141, 3362, 3501, 3548, 3501, 3362, 3141, 2852, 2512, 2142, 1767, 1409, 1092, 834, 653, 560, 560, 653, 834, 1092, 1409, 1767, 2142, 2512, 2852, 3141, 3362, 3501, 3548, 3501, 3362, 3141, 2852, 2512, 2142, 1767, 1409, 1092, 834, 653, 560, 560, 653, 834, 1092, 1409, 1767, 2142, 2512, 2852, 3141, 3362, 3501, 3548, 3501, 3362, 3141, 2852, 2512, 2142, 1767, 1409, 1092, 834, 653, 560, 560, 653, 834, 1092, 1409, 1767, 2142, 2512, 2852, 3141, 3362, 3501, 3548, 3501, 3362, 3141, 2852, 2512, 2142, 1767, 1409, 1092, 834, 653, 560, 560, 653, 834, 1092, 1409, 1767, 2142, 2512, 2852, 3141, 3362, 3501, 3548, 3501, 3362, 3141, 2852, 2512, 2142, 1767, 1409, 1092, 834, 653, 560, 560, 653, 834, 1092, 1409, 1767, 2142, 2512, 2852, 3141, 3362, 3501, 3548,
        3488, 3314, 3040, 2687, 2283, 1860, 1452, 1092, 807, 621, 549, 595, 757, 1021, 1367, 1767, 2189, 2600, 2967, 3262, 3459, 3545, 3512, 3362, 3109, 2771, 2375, 1954, 1540, 1166, 863, 653, 555, 575, 711, 955, 1284, 1675, 2095, 2512, 2891, 3204, 3425, 3536, 3530, 3405, 3173, 2852, 2466, 2048, 1630, 1244, 923, 691, 566, 560, 671, 892, 1205, 1584, 2001, 2421, 2812, 3141, 3385, 3521, 3541, 3443, 3233, 2930, 2556, 2142, 1721, 1325, 987, 734, 584, 551, 637, 834, 1129, 1496, 1907, 2329, 2729, 3075, 3339, 3501, 3547, 3475, 3289, 3004, 2644, 2236, 1813, 1409, 1056, 782, 608, 548, 608, 782, 1056, 1409, 1813, 2236, 2644, 3004, 3289, 3475, 3547, 3501, 3339, 3075, 2729, 2329, 1907, 1496, 1129, 834, 637, 551, 584, 734, 987, 1325, 1721, 2142, 2556, 2930, 3233, 3443, 3541, 3521, 3385, 3141, 2812, 2421, 2001, 1584, 1205, 892, 671, 560, 566, 691, 923, 1244, 1630, 2048, 2466, 2852, 3173, 3405, 3530, 3536, 3425, 3204, 2891, 2512, 2095, 1675, 1284, 955, 711, 575, 555, 653, 863, 1166, 1540, 1954, 2375, 2771, 3109, 3362, 3512, 3545, 3459, 3262, 2967, 2600, 2189, 1767, 1367, 1021, 757, 595, 549, 621, 807, 1092, 1452, 1860, 2283, 2687, 3040, 3314, 3488, 3548,
        3475, 3262, 2930, 2512, 2048, 1584, 1166, 834, 621, 548, 621, 834, 1166, 1584, 2048, 2512, 2930, 3262, 3475, 3548, 3475, 3262, 2930, 2512, 2048, 1584, 1166, 834, 621, 548, 621, 834, 1166, 1584, 2048, 2512, 2930, 3262, 3475, 3548, 3475, 3262, 2930, 2512, 2048, 1584, 1166, 834, 621, 548, 621, 834, 1166, 1584, 2048, 2512, 2930, 3262, 3475, 3548, 3475, 3262, 2930, 2512, 2048, 1584, 1166, 834, 621, 548, 621, 834, 1166, 1584, 2048, 2512, 2930, 3262, 3475, 3548, 3475, 3262, 2930, 2512, 2048, 1584, 1166, 834, 621, 548, 621, 834, 1166, 1584, 2048, 2512, 2930, 3262, 3475, 3548, 3475, 3262, 2930, 2512, 2048, 1584, 1166, 834, 621, 548, 621, 834, 1166, 1584, 2048, 2512, 2930, 3262, 3475, 3548, 3475, 3262, 2930, 2512, 2048, 1584, 1166, 834, 621, 548, 621, 834, 1166, 1584, 2048, 2512, 2930, 3262, 3475, 3548, 3475, 3262, 2930, 2512, 2048, 1584, 1166, 834, 621, 548, 621, 834, 1166, 1584, 2048, 2512, 2930, 3262, 3475, 3548, 3475, 3262, 2930, 2512, 2048, 1584, 1166, 834, 621, 548, 621, 834, 1166, 1584, 2048, 2512, 2930, 3262, 3475, 3548, 3475, 3262, 2930, 2512, 2048, 1584, 1166, 834, 621, 548, 621, 834, 1166, 1584, 2048, 2512, 2930, 3262, 3475, 3548,
        3459, 3204, 2812, 2329, 1813, 1325, 923, 653, 549, 621, 863, 1244, 1721, 2236, 2729, 3141, 3425, 3545, 3488, 3262, 2891, 2421, 1907, 1409, 987, 691, 555, 595, 807, 1166, 1630, 2142, 2644, 3075, 3385, 3536, 3512, 3314, 2967, 2512, 2001, 1496, 1056, 734, 566, 575, 757, 1092, 1540, 2048, 2556, 3004, 3339, 3521, 3530, 3362, 3040, 2600, 2095, 1584, 1129, 782, 584, 560, 711, 1021, 1452, 1954, 2466, 2930, 3289, 3501, 3541, 3405, 3109, 2687, 2189, 1675, 1205, 834, 608, 551, 671, 955, 1367, 1860, 2375, 2852, 3233, 3475, 3547, 3443, 3173, 2771, 2283, 1767, 1284, 892, 637, 548, 637, 892, 1284, 1767, 2283, 2771, 3173, 3443, 3547, 3475, 3233, 2852, 2375, 1860, 1367, 955, 671, 551, 608, 834, 1205, 1675, 2189, 2687, 3109, 3405, 3541, 3501, 3289, 2930, 2466, 1954, 1452, 1021, 711, 560, 584, 782, 1129, 1584, 2095, 2600, 3040, 3362, 3530, 3521, 3339, 3004, 2556, 2048, 1540, 1092, 757, 575, 566, 734, 1056, 1496, 2001, 2512, 2967, 3314, 3512, 3536, 3385, 3075, 2644, 2142, 1630, 1166, 807, 595, 555, 691, 987, 1409, 1907, 2421, 2891, 3262, 3488, 3545, 3425, 3141, 2729, 2236, 1721, 1244, 863, 621, 549, 653, 923, 1325, 1813, 2329, 2812, 3204, 3459, 3548,
        3443, 3141, 2687, 2142, 1584, 1092, 734, 560, 595, 834, 1244, 1767, 2329, 2852, 3262, 3501, 3536, 3362, 3004, 2512, 1954, 1409, 955, 653, 548, 653, 955, 1409, 1954, 2512, 3004, 3362, 3536, 3501, 3262, 2852, 2329, 1767, 1244, 834, 595, 560, 734, 1092, 1584, 2142, 2687, 3141, 3443, 3548, 3443, 3141, 2687, 2142, 1584, 1092, 734, 560, 595, 834, 1244, 1767, 2329, 2852, 3262, 3501, 3536, 3362, 3004, 2512, 1954, 1409, 955, 653, 548, 653, 955, 1409, 1954, 2512, 3004, 3362, 3536, 3501, 3262, 2852, 2329, 1767, 1244, 834, 595, 560, 734, 1092, 1584, 2142, 2687, 3141, 3443, 3548, 3443, 3141, 2687, 2142, 1584, 1092, 734, 560, 595, 834, 1244, 1767, 2329, 2852, 3262, 3501, 3536, 3362, 3004, 2512, 1954, 1409, 955, 653, 548, 653, 955, 1409, 1954, 2512, 3004, 3362, 3536, 3501, 3262, 2852, 2329, 1767, 1244, 834, 595, 560, 734, 1092, 1584, 2142, 2687, 3141, 3443, 3548, 3443, 3141, 2687, 2142, 1584, 1092, 734, 560, 595, 834, 1244, 1767, 2329, 2852, 3262, 3501, 3536, 3362, 3004, 2512, 1954, 1409, 955, 653, 548, 653, 955, 1409, 1954, 2512, 3004, 3362, 3536, 3501, 3262, 2852, 2329, 1767, 1244, 834, 595, 560, 734, 1092, 1584, 2142, 2687, 3141, 3443, 3548,
        3425, 3075, 2556, 1954, 1367, 892, 608, 560, 757, 1166, 1721, 2329, 2891, 3314, 3530, 3501, 3233, 2771, 2189, 1584, 1056, 691, 549, 653, 987, 1496, 2095, 2687, 3173, 3475, 3541, 3362, 2967, 2421, 1813, 1244, 807, 575, 584, 834, 1284, 1860, 2466, 3004, 3385, 3545, 3459, 3141, 2644, 2048, 1452, 955, 637, 551, 711, 1092, 1630, 2236, 2812, 3262, 3512, 3521, 3289, 2852, 2283, 1675, 1129, 734, 555, 621, 923, 1409, 2001, 2600, 3109, 3443, 3547, 3405, 3040, 2512, 1907, 1325, 863, 595, 566, 782, 1205, 1767, 2375, 2930, 3339, 3536, 3488, 3204, 2729, 2142, 1540, 1021, 671, 548, 671, 1021, 1540, 2142, 2729, 3204, 3488, 3536, 3339, 2930, 2375, 1767, 1205, 782, 566, 595, 863, 1325, 1907, 2512, 3040, 3405, 3547, 3443, 3109, 2600, 2001, 1409, 923, 621, 555, 734, 1129, 1675, 2283, 2852, 3289, 3521, 3512, 3262, 2812, 2236, 1630, 1092, 711, 551, 637, 955, 1452, 2048, 2644, 3141, 3459, 3545, 3385, 3004, 2466, 1860, 1284, 834, 584, 575, 807, 1244, 1813, 2421, 2967, 3362, 3541, 3475, 3173, 2687, 2095, 1496, 987, 653, 549, 691, 1056, 1584, 2189, 2771, 3233, 3501, 3530, 3314, 2891, 2329, 1721, 1166, 757, 560, 608, 892, 1367, 1954, 2556, 3075, 3425, 3548,
        3405, 3004, 2421, 1767, 1166, 734, 551, 653, 1021, 1584, 2236, 2852, 3314, 3536, 3475, 3141, 2600, 1954, 1325, 834, 575, 595, 892, 1409, 2048, 2687, 3204, 3501, 3521, 3262, 2771, 2142, 1496, 955, 621, 560, 782, 1244, 1860, 2512, 3075, 3443, 3545, 3362, 2930, 2329, 1675, 1092, 691, 548, 691, 1092, 1675, 2329, 2930, 3362, 3545, 3443, 3075, 2512, 1860, 1244, 782, 560, 621, 955, 1496, 2142, 2771, 3262, 3521, 3501, 3204, 2687, 2048, 1409, 892, 595, 575, 834, 1325, 1954, 2600, 3141, 3475, 3536, 3314, 2852, 2236, 1584, 1021, 653, 551, 734, 1166, 1767, 2421, 3004, 3405, 3548, 3405, 3004, 2421, 1767, 1166, 734, 551, 653, 1021, 1584, 2236, 2852, 3314, 3536, 3475, 3141, 2600, 1954, 1325, 834, 575, 595, 892, 1409, 2048, 2687, 3204, 3501, 3521, 3262, 2771, 2142, 1496, 955, 621, 560, 782, 1244, 1860, 2512, 3075, 3443, 3545, 3362, 2930, 2329, 1675, 1092, 691, 548, 691, 1092, 1675, 2329, 2930, 3362, 3545, 3443, 3075, 2512, 1860, 1244, 782, 560, 621, 955, 1496, 2142, 2771, 3262, 3521, 3501, 3204, 2687, 2048, 1409, 892, 595, 575, 834, 1325, 1954, 2600, 3141, 3475, 3536, 3314, 2852, 2236, 1584, 1021, 653, 551, 734, 1166, 1767, 2421, 3004, 3405, 3548,
        3385, 2930, 2283, 1584, 987, 621, 566, 834, 1367, 2048, 2729, 3262, 3530, 3475, 3109, 2512, 1813, 1166, 711, 548, 711, 1166, 1813, 2512, 3109, 3475, 3530, 3262, 2729, 2048, 1367, 834, 566, 621, 987, 1584, 2283, 2930, 3385, 3548, 3385, 2930, 2283, 1584, 987, 621, 566, 834, 1367, 2048, 2729, 3262, 3530, 3475, 3109, 2512, 1813, 1166, 711, 548, 711, 1166, 1813, 2512, 3109, 3475, 3530, 3262, 2729, 2048, 1367, 834, 566, 621, 987, 1584, 2283, 2930, 3385, 3548, 3385, 2930, 2283, 1584, 987, 621, 566, 834, 1367, 2048, 2729, 3262, 3530, 3475, 3109, 2512, 1813, 1166, 711, 548, 711, 1166, 1813, 2512, 3109, 3475, 3530, 3262, 2729, 2048, 1367, 834, 566, 621, 987, 1584, 2283, 2930, 3385, 3548, 3385, 2930, 2283, 1584, 987, 621, 566, 834, 1367, 2048, 2729, 3262, 3530, 3475, 3109, 2512, 1813, 1166, 711, 548, 711, 1166, 1813, 2512, 3109, 3475, 3530, 3262, 2729, 2048, 1367, 834, 566, 621, 987, 1584, 2283, 2930, 3385, 3548, 3385, 2930, 2283, 1584, 987, 621, 566, 834, 1367, 2048, 2729, 3262, 3530, 3475, 3109, 2512, 1813, 1166, 711, 548, 711, 1166, 1813, 2512, 3109, 3475, 3530, 3262, 2729, 2048, 1367, 834, 566, 621, 987, 1584, 2283, 2930, 3385, 3548,
        3362, 2852, 2142, 1409, 834, 560, 653, 1092, 1767, 2512, 3141, 3501, 3501, 3141, 2512, 1767, 1092, 653, 560, 834, 1409, 2142, 2852, 3362, 3548, 3362, 2852, 2142, 1409, 834, 560, 653, 1092, 1767, 2512, 3141, 3501, 3501, 3141, 2512, 1767, 1092, 653, 560, 834, 1409, 2142, 2852, 3362, 3548, 3362, 2852, 2142, 1409, 834, 560, 653, 1092, 1767, 2512, 3141, 3501, 3501, 3141, 2512, 1767, 1092, 653, 560, 834, 1409, 2142, 2852, 3362, 3548, 3362, 2852, 2142, 1409, 834, 560, 653, 1092, 1767, 2512, 3141, 3501, 3501, 3141, 2512, 1767, 1092, 653, 560, 834, 1409, 2142, 2852, 3362, 3548, 3362, 2852, 2142, 1409, 834, 560, 653, 1092, 1767, 2512, 3141, 3501, 3501, 3141, 2512, 1767, 1092, 653, 560, 834, 1409, 2142, 2852, 3362, 3548, 3362, 2852, 2142, 1409, 834, 560, 653, 1092, 1767, 2512, 3141, 3501, 3501, 3141, 2512, 1767, 1092, 653, 560, 834, 1409, 2142, 2852, 3362, 3548, 3362, 2852, 2142, 1409, 834, 560, 653, 1092, 1767, 2512, 3141, 3501, 3501, 3141, 2512, 1767, 1092, 653, 560, 834, 1409, 2142, 2852, 3362, 3548, 3362, 2852, 2142, 1409, 834, 560, 653, 1092, 1767, 2512, 3141, 3501, 3501, 3141, 2512, 1767, 1092, 653, 560, 834, 1409, 2142, 2852, 3362, 3548,
        3339, 2771, 2001, 1244, 711, 551, 807, 1409, 2189, 2930, 3425, 3536, 3233, 2600, 1813, 1092, 637, 575, 923, 1584, 2375, 3075, 3488, 3501, 3109, 2421, 1630, 955, 584, 621, 1056, 1767, 2556, 3204, 3530, 3443, 2967, 2236, 1452, 834, 555, 691, 1205, 1954, 2729, 3314, 3547, 3362, 2812, 2048, 1284, 734, 549, 782, 1367, 2142, 2891, 3405, 3541, 3262, 2644, 1860, 1129, 653, 566, 892, 1540, 2329, 3040, 3475, 3512, 3141, 2466, 1675, 987, 595, 608, 1021, 1721, 2512, 3173, 3521, 3459, 3004, 2283, 1496, 863, 560, 671, 1166, 1907, 2687, 3289, 3545, 3385, 2852, 2095, 1325, 757, 548, 757, 1325, 2095, 2852, 3385, 3545, 3289, 2687, 1907, 1166, 671, 560, 863, 1496, 2283, 3004, 3459, 3521, 3173, 2512, 1721, 1021, 608, 595, 987, 1675, 2466, 3141, 3512, 3475, 3040, 2329, 1540, 892, 566, 653, 1129, 1860, 2644, 3262, 3541, 3405, 2891, 2142, 1367, 782, 549, 734, 1284, 2048, 2812, 3362, 3547, 3314, 2729, 1954, 1205, 691, 555, 834, 1452, 2236, 2967, 3443, 3530, 3204, 2556, 1767, 1056, 621, 584, 955, 1630, 2421, 3109, 3501, 3488, 3075, 2375, 1584, 923, 575, 637, 1092, 1813, 2600, 3233, 3536, 3425, 2930, 2189, 1409, 807, 551, 711, 1244, 2001, 2771, 3339, 3548,
        3314, 2687, 1860, 1092, 621, 595, 1021, 1767, 2600, 3262, 3545, 3362, 2771, 1954, 1166, 653, 575, 955, 1675, 2512, 3204, 3536, 3405, 2852, 2048, 1244, 691, 560, 892, 1584, 2421, 3141, 3521, 3443, 2930, 2142, 1325, 734, 551, 834, 1496, 2329, 3075, 3501, 3475, 3004, 2236, 1409, 782, 548, 782, 1409, 2236, 3004, 3475, 3501, 3075, 2329, 1496, 834, 551, 734, 1325, 2142, 2930, 3443, 3521, 3141, 2421, 1584, 892, 560, 691, 1244, 2048, 2852, 3405, 3536, 3204, 2512, 1675, 955, 575, 653, 1166, 1954, 2771, 3362, 3545, 3262, 2600, 1767, 1021, 595, 621, 1092, 1860, 2687, 3314, 3548, 3314, 2687, 1860, 1092, 621, 595, 1021, 1767, 2600, 3262, 3545, 3362, 2771, 1954, 1166, 653, 575, 955, 1675, 2512, 3204, 3536, 3405, 2852, 2048, 1244, 691, 560, 892, 1584, 2421, 3141, 3521, 3443, 2930, 2142, 1325, 734, 551, 834, 1496, 2329, 3075, 3501, 3475, 3004, 2236, 1409, 782, 548, 782, 1409, 2236, 3004, 3475, 3501, 3075, 2329, 1496, 834, 551, 734, 1325, 2142, 2930, 3443, 3521, 3141, 2421, 1584, 892, 560, 691, 1244, 2048, 2852, 3405, 3536, 3204, 2512, 1675, 955, 575, 653, 1166, 1954, 2771, 3362, 3545, 3262, 2600, 1767, 1021, 595, 621, 1092, 1860, 2687, 3314, 3548,
        3289, 2600, 1721, 955, 566, 691, 1284, 2142, 2967, 3475, 3488, 3004, 2189, 1325, 711, 560, 923, 1675, 2556, 3262, 3547, 3314, 2644, 1767, 987, 575, 671, 1244, 2095, 2930, 3459, 3501, 3040, 2236, 1367, 734, 555, 892, 1630, 2512, 3233, 3545, 3339, 2687, 1813, 1021, 584, 653, 1205, 2048, 2891, 3443, 3512, 3075, 2283, 1409, 757, 551, 863, 1584, 2466, 3204, 3541, 3362, 2729, 1860, 1056, 595, 637, 1166, 2001, 2852, 3425, 3521, 3109, 2329, 1452, 782, 549, 834, 1540, 2421, 3173, 3536, 3385, 2771, 1907, 1092, 608, 621, 1129, 1954, 2812, 3405, 3530, 3141, 2375, 1496, 807, 548, 807, 1496, 2375, 3141, 3530, 3405, 2812, 1954, 1129, 621, 608, 1092, 1907, 2771, 3385, 3536, 3173, 2421, 1540, 834, 549, 782, 1452, 2329, 3109, 3521, 3425, 2852, 2001, 1166, 637, 595, 1056, 1860, 2729, 3362, 3541, 3204, 2466, 1584, 863, 551, 757, 1409, 2283, 3075, 3512, 3443, 2891, 2048, 1205, 653, 584, 1021, 1813, 2687, 3339, 3545, 3233, 2512, 1630, 892, 555, 734, 1367, 2236, 3040, 3501, 3459, 2930, 2095, 1244, 671, 575, 987, 1767, 2644, 3314, 3547, 3262, 2556, 1675, 923, 560, 711, 1325, 2189, 3004, 3488, 3475, 2967, 2142, 1284, 691, 566, 955, 1721, 2600, 3289, 3548,
        3262, 2512, 1584, 834, 548, 834, 1584, 2512, 3262, 3548, 3262, 2512, 1584, 834, 548, 834, 1584, 2512, 3262, 3548, 3262, 2512, 1584, 834, 548, 834, 1584, 2512, 3262, 3548, 3262, 2512, 1584, 834, 548, 834, 1584, 2512, 3262, 3548, 3262, 2512, 1584, 834, 548, 834, 1584, 2512, 3262, 3548, 3262, 2512, 1584, 834, 548, 834, 1584, 2512, 3262, 3548, 3262, 2512, 1584, 834, 548, 834, 1584, 2512, 3262, 3548, 3262, 2512, 1584, 834, 548, 834, 1584, 2512, 3262, 3548, 3262, 2512, 1584, 834, 548, 834, 1584, 2512, 3262, 3548, 3262, 2512, 1584, 834, 548, 834, 1584, 2512, 3262, 3548, 3262, 2512, 1584, 834, 548, 834, 1584, 2512, 3262, 3548, 3262, 2512, 1584, 834, 548, 834, 1584, 2512, 3262, 3548, 3262, 2512, 1584, 834, 548, 834, 1584, 2512, 3262, 3548, 3262, 2512, 1584, 834, 548, 834, 1584, 2512, 3262, 3548, 3262, 2512, 1584, 834, 548, 834, 1584, 2512, 3262, 3548, 3262, 2512, 1584, 834, 548, 834, 1584, 2512, 3262, 3548, 3262, 2512, 1584, 834, 548, 834, 1584, 2512, 3262, 3548, 3262, 2512, 1584, 834, 548, 834, 1584, 2512, 3262, 3548, 3262, 2512, 1584, 834, 548, 834, 1584, 2512, 3262, 3548, 3262, 2512, 1584, 834, 548, 834, 1584, 2512, 3262, 3548};

int main()
{
again:
    // 信号重建思路
    // 采集信号之后，确定参数，进行重建

    // AD采样
	//MyDAC_Init();
	//DACCLK = 1;
	//DAC_Set_Volt(-1.5);
	//DAC_Mode_Init();
	
	
	ADC_GPIO_Init();						    // ADC引脚初始化。
	TIM3_Config();                     // 触发ADC采样频率，采样频率2MHz
	ADC_Config();                               // ADC 2000K采样频率，采集6000个数据，需要花费3ms
	ADC_DMA_Trig( ADC1_DMA_Size ); 	// 开始AD采集，设置采样点数
	delay_ms(2); // 延时3ms，等待ADC数据全部转换到 ADC1_ConvertedValue数组中
	for(int i=0; i<1000; i++)
	{
		ADCConvertedValue[i] = ADC1_ConvertedValue[i];
	}
	
	cal_2frqs(fre);
	
	for(int i=0; i<200; i++)
	{
		meDA1_Value[i] = DAC_SIN[fre[0]*200+i];
		meDA2_Value[i] = DAC_SIN[fre[1]*200+i];
	}
	
	TIM4_Init();
	DA1_Init();
	TIM5_Init();
	DA2_Init();

    // 计算正交


    // 最后，需要实时调整相位差

    // 后端需要接运放放大幅度，不然难以达到 1Vpp
    //AD9959_Set_Amp(CH0, 1023);
    //AD9959_Set_Amp(CH1, 1023);

    // 计算A与A' B和B' 的相位差，调至相同（由于频率肯定不完全相同，所有总会有滚动，要时刻调整相位消除滚动，使其不可见）
    while (1)
    {
		ADC_DMA_Trig( ADC1_DMA_Size ); 	// 开始AD采集，设置采样点数
		delay_ms(2);
		for(int i=0; i<1000; i++)
		{
			ADCConvertedValue[i] = ADC1_ConvertedValue[i];
		}
		get_pos_angle();
		
		

        AD9959_Set_Phase(CH0, (pos_angle_0 * 16383) / (2 * 3.1415926));
        AD9959_Set_Phase(CH1, (pos_angle_1 * 16383) / (2 * 3.1415926));

        IO_Update();

        // 接收到重启信号
        if (flag == 1)
        {
            flag = 0;
            goto again;
        }
    }
}

// 确定频率用
double corr1000_200(short *data, short *mask)
{
    double res = 0;
    short i;
    for (i = 0; i < 1000; i++)
        res = res + (data[i] - 2048) * (mask[i % 200] - 2048); // 注意SIN与COS模版要减去直流偏置，才是真正的信号
    return res;
}

// 计算IQ分量的模的长度
double modulus(double I, double Q)
{
    double temp_double;
    temp_double = sqrt(I * I + Q * Q);
    return temp_double;
}

void cal_2frqs(unsigned char *frq) // 计算参与叠加的两个正弦信号的频率
{
    double corr_sin_double; // 用于存放C与所有19种正弦相关计算的结果
    double corr_cos_double; // 用于存放C与所有19种余弦相关计算的结果
    double mag[19];         // 用于存放输入信号与所有19种信号相关计算的模
    double temp_double[19], sort_temp;
    unsigned char i, j, temp_char;
    for (i = 0; i < 19; i++)
    {
        corr_sin_double = corr1000_200(ADCConvertedValue, DAC_SIN + 200 * i);
        corr_cos_double = corr1000_200(ADCConvertedValue, DAC_COS + 200 * i);
        mag[i] = modulus(corr_sin_double, corr_cos_double);
        temp_double[i] = mag[i];
    }
    // 冒泡法对大小进行排序
    for (i = 0; i < 19 - 1; i++)
    {
        for (j = 0; j < 19 - i - 1; j++)
        {
            if (temp_double[j] < temp_double[j + 1])
            {
                sort_temp = temp_double[j];
                temp_double[j] = temp_double[j + 1];
                temp_double[j + 1] = sort_temp;
            }
        }
    }
    // 寻找最大值序号
    for (i = 0; i < 19; i++)
    {
        if (mag[i] == temp_double[0]) // 找到最大数
            frq[0] = i;
        if (mag[i] == temp_double[1]) // 找到第二大数
            frq[1] = i;
    }
    if (frq[0] > frq[1])
    { // 把频率低的放在第一个位置，如果颠倒就换一下
        temp_char = frq[0];
        frq[0] = frq[1];
        frq[1] = temp_char;
    }
}

void get_pos_angle(void)
{
    unsigned char i = 0;
    double temp_double_sin = corr1000_200(ADCConvertedValue, DAC_SIN + 200 * fre[0]);
    double temp_double_cos = corr1000_200(ADCConvertedValue, DAC_COS + 200 * fre[0]);
    double temp_double_angle_0 = atan2(temp_double_cos, temp_double_sin);

    if (temp_double_angle_0 < 0) // atan2函数计算得到的相位差在-pi到pi，但当其小于0时，DAC输出的信号无法提前相位，只能将所有相位全部延迟一个周期，即进行一个周期的求补操作
        pos_angle_0 = -temp_double_angle_0;
    else
        pos_angle_0 = 2 * 3.1415926 - temp_double_angle_0;

    temp_double_sin = corr1000_200(ADCConvertedValue, DAC_SIN + 200 * fre[1]);
    temp_double_cos = corr1000_200(ADCConvertedValue, DAC_COS + 200 * fre[1]);
    double temp_double_angle_1 = atan2(temp_double_cos, temp_double_sin);

    if (temp_double_angle_1 < 0) // atan2函数计算得到的相位差在-pi到pi，但当其小于0时，DAC输出的信号无法提前相位，只能将所有相位全部延迟一个周期，即进行一个周期的求补操作
        pos_angle_1 = -temp_double_angle_1;
    else
        pos_angle_1 = 2 * 3.1415926 - temp_double_angle_1;
}

// 提高部分

void fft_cal_2types(unsigned char *frq, unsigned char *wave_type) // 根据输入信号及已经判断出来的频率值，通过FFT结果判断信号类型是三角波（1）还是正弦波（0）
// 第一个参数指针指向的数组，其中存放的是之前的其他函数计算出来的两个信号的频率
// 第二个参数指正指向的数组用于存放这两个信号的波形种类，0为正弦，其他值为三角波。需要在本函数中计算产生
{
    short indata[2048], outdata[2048], i;
    int mag[512], sum = 0, average;
    unsigned short index;                      // 输入信号的频率对应的索引值
    unsigned short harmo3_index, harmo5_index; // 输入信号三次和五次谐波频率对应的索引值
    float temp_float;
    float mag_1harmo, mag_3harmo, k; // 一次和三次谐波上的能量及其比值
    float mag_5harmo;                // 五次谐波上的能量
    _Bool conti;

    for (i = 0; i < 1024; i++) // 计算信号平均值
        sum = sum + ADCConvertedValue[i];
    average = sum / 1024;
    for (i = 0; i < 1024; i++)
    {
        indata[2 * i] = ADCConvertedValue[i] - average; // 减去平均值是为了降低直流分量
        indata[2 * i + 1] = 0;
    }
    //cr4_fft_1024_stm32(outdata, indata, 1024);                                              // 注意阅读关于输入输出数据存放格式的描述
    for (i = 0; i < 512; i++)                                                               // FFT结果幅度谱是左右对称的，只需要算一半
        mag[i] = outdata[2 * i] * outdata[2 * i] + outdata[2 * i + 1] * outdata[2 * i + 1]; // sqrt(outdata[2*i] * outdata[2*i] + outdata[2*i + 1] * outdata[2*i + 1]);

    //////////计算输入信号频率及其三次谐波频率对应在FFT结果数组中的索引值//////////
    //////初步判断第一个信号的类型//////////////
    temp_float = (float)frq[0] * 5 + 10; // 计算输入索引值所对应的真实频率，单位为KHz
    temp_float = temp_float / 500;       // 采样率为1MSPS，则输入频率是奈奎斯特频率的多少倍
    temp_float = temp_float * 512;       // 计算输入信号频率对应的数组索引
    index = temp_float + 0.5;            // 进行四舍五入取整

    temp_float = (float)frq[0] * 5 + 10; // 计算输入索引值所对应的真实频率，单位为KHz
    temp_float = temp_float / 500;       // 采样率为1MSPS，则输入频率是奈奎斯特频率的多少倍
    temp_float = temp_float * 3 * 512;   // 计算三倍基频对应的数组索引
    harmo3_index = temp_float + 0.5;     // 进行四舍五入取整

    mag_1harmo = mag[index - 1] + mag[index] + mag[index + 1];
    mag_3harmo = mag[harmo3_index - 1] + mag[harmo3_index] + mag[harmo3_index + 1];
    k = mag_1harmo / mag_3harmo;
    if (k > 300)
        wave_type[0] = 0; // 三次谐波较小，说明是正弦波
    else
        wave_type[0] = 1; // 三次谐波较大，说明是三角波
    //////////初步判断第二个信号的类型////////////////
    temp_float = (float)frq[1] * 5 + 10; // 计算输入索引值所对应的真实频率，单位为KHz
    temp_float = temp_float / 500;       // 采样率为1MSPS，则输入频率是奈奎斯特频率的多少倍
    temp_float = temp_float * 512;       // 计算输入信号频率对应的数组索引
    index = temp_float + 0.5;            // 进行四舍五入取整

    temp_float = (float)frq[1] * 5 + 10; // 计算输入索引值所对应的真实频率，单位为KHz
    temp_float = temp_float / 500;       // 采样率为1MSPS，则输入频率是奈奎斯特频率的多少倍
    temp_float = temp_float * 3 * 512;   // 计算三倍基频对应的数组索引
    harmo3_index = temp_float + 0.5;     // 进行四舍五入取整

    mag_1harmo = mag[index - 1] + mag[index] + mag[index + 1];
    mag_3harmo = mag[harmo3_index - 1] + mag[harmo3_index] + mag[harmo3_index + 1];
    k = mag_1harmo / mag_3harmo;
    if (k > 300)
        wave_type[1] = 0; // 三次谐波较小，说明是正弦波
    else
        wave_type[1] = 1; // 三次谐波较大，说明是三角波

    ////////对第二个信号刚好等于第一个信号三倍频率特殊情况，需要重新判断第一个信号的类型/////
    // 上面的初步判断算有问题的是：第二个信号四第一个信号三倍频率的情况，只有可能包括：
    // 1、第一个信号是10K，第二个信号是30K
    // 2、第一个信号是15K，第二个信号是45K
    // 3、第一个信号是20K，第二个信号是60K
    // 4、第一个信号是25K，第二个信号是75K
    // 5、第一个信号是30K，第二个信号是90K
    conti = ((frq[0] == 0) & (frq[1] == 4)) | ((frq[0] == 1) & (frq[1] == 7)) | ((frq[0] == 2) & (frq[1] == 10)) | ((frq[0] == 3) & (frq[1] == 13)) | ((frq[0] == 4) & (frq[1] == 16));
    if (conti)
    {
        // 计算五次谐波能量和1次谐波能量之比
        temp_float = (float)frq[0] * 5 + 10; // 计算输入索引值所对应的真实频率，单位为KHz
        temp_float = temp_float / 500;       // 采样率为1MSPS，则输入频率是奈奎斯特频率的多少倍
        temp_float = temp_float * 512;       // 计算输入信号频率对应的数组索引
        index = temp_float + 0.5;            // 进行四舍五入取整
        mag_1harmo = mag[index - 1] + mag[index] + mag[index + 1];
        temp_float = (float)frq[0] * 5 + 10; // 计算输入索引值所对应的真实频率，单位为KHz
        temp_float = temp_float / 500;       // 采样率为1MSPS，则输入频率是奈奎斯特频率的多少倍
        temp_float = temp_float * 5 * 512;   // 计算5倍基频对应的数组索引
        harmo5_index = temp_float + 0.5;     // 进行四舍五入取整
        mag_5harmo = mag[harmo5_index - 1] + mag[harmo5_index] + mag[harmo5_index + 1];
        k = mag_1harmo / mag_5harmo;
        if (k > 500)
            wave_type[0] = 0; // 5次谐波较小，说明是正弦波
        else
            wave_type[0] = 1; // 5次谐波较大，说明是三角波
    }
}
